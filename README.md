# Agently 3.0-Alphaç‰ˆä»‹ç»æ‰‹å†Œ

1.0åŠ2.0ç‰ˆæœ¬è¯´æ˜æ‰‹å†Œå¯å‚è§ï¼š[æ–‡æ¡£åˆé›†](https://github.com/Maplemx/Agently/tree/main/doc)

> ğŸ¥· ä½œè€…ï¼šMaplemx ï½œ ğŸ“§ Emailï¼šmaplemx@gmail.com | ğŸ’¬ å¾®ä¿¡ï¼šmoxinapp
>
> â‰ï¸ [å¦‚æœæ‚¨å‘ç°äº†BUGï¼Œæˆ–è€…æœ‰å¥½çš„ç‚¹å­ï¼Œè¯·åœ¨è¿™é‡Œæäº¤](https://github.com/Maplemx/Agently/issues)
> 
>  â­ï¸ å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·è½¬å‘ç»™æ‚¨èº«è¾¹å¯¹å¤§è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¹¶ç»™é¡¹ç›®åŠ æ˜Ÿï¼Œæ„Ÿè°¢æ‚¨çš„è‚¯å®šå’Œæ”¯æŒï¼
>
>  ğŸ‘¾ Discordç¾¤ç»„é‚€è¯·é“¾æ¥ï¼š[https://discord.gg/j9CvXXJG](https://discord.gg/ufEk56Rk)
>
>  ğŸ‘¥ å¾®ä¿¡è®¨è®ºç¾¤ï¼š
> <img width="180" alt="image" src="https://github.com/Maplemx/Agently/assets/4413155/5fe467bb-e1c4-4550-9eaa-c59dc3221f58">
> 



3.0-Alphaç‰ˆæœ¬å®‰è£…æ–¹æ³•ï¼š`pip install Agently==3.0.0a7`

> âš ï¸3.0.0a6æœ‰ä¸€ä¸ªå°bugéœ€è¦æ‰‹åŠ¨fixï¼Œ[è¯¦æƒ…è¯·å‚è§](https://github.com/Maplemx/Agently/commit/45535d3d11b3502eedcd3aa5bae67f86dd1422a7)ï¼Œå°†åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬æ›´æ–°æ—¶ä¿®å¤

Githubé¡¹ç›®åœ°å€ï¼š[https://github.com/Maplemx/Agently](https://github.com/Maplemx/Agently)

<img width="1315" alt="image" src="https://github.com/Maplemx/Agently/assets/4413155/301729ea-8d26-4c40-9689-8e7c12a6ffbd">

## è®©æˆ‘ä»¬å…ˆæ¥èŠèŠæ™ºèƒ½ä½“ï¼ˆAgentï¼‰

éšç€ä»¥ChatGPTä¸ºä»£è¡¨çš„å¯¹è¯å¼è¯­è¨€æ¨¡å‹äº¤äº’ç•Œé¢çš„ç«çˆ†å‡ºåœˆï¼Œè¶Šæ¥è¶Šå¤šçš„æ™®é€šç”¨æˆ·æ¥è§¦åˆ°äº†å¤§å‹è¯­è¨€æ¨¡å‹ã€‚å¯¹è¯å¼äº¤äº’çš„ç®€å•æ˜“ç”¨ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ç»™å‡ºåé¦ˆæ—¶è¡¨ç°å‡ºçš„ç†è§£èƒ½åŠ›ã€è¡¨è¾¾èƒ½åŠ›ã€çŸ¥è¯†ä¸°å¯Œç¨‹åº¦ç”šè‡³å‘ˆç°å‡ºçš„ä¸€å®šçš„æ¨ç†èƒ½åŠ›ï¼Œéƒ½è®©ç”¨æˆ·æƒŠå¹ä¸å·²ã€‚

è¿™æ ·èªæ˜çš„è¡¨ç°ï¼Œè®©äººä»¬å¯¹å¤§å‹è¯­è¨€æ¨¡å‹çš„æœŸå¾…ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚

> â€œä½ èƒ½ä¸èƒ½ä¸ªæ€§é²œæ˜ä¸€ç‚¹ï¼Ÿâ€
> 
> â€œä½ èƒ½ä¸èƒ½æ›´äº†è§£è¿™ä¸ªä¸–ç•Œåœ¨å‘ç”Ÿä»€ä¹ˆï¼Ÿâ€
> 
> â€œæˆ‘å¸Œæœ›ä½ èƒ½æ›´ä»”ç»†åœ°æ€è€ƒï¼Œè€Œä¸æ˜¯ä»“ä¿ƒå›ç­”â€

è¿™äº›éƒ½æ˜¯æˆ‘ä»¬å¬åˆ°çš„ï¼ŒçœŸå®ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ChatGPTæˆ–è€…ç±»ä¼¼çš„å¯¹è¯å¼å¤§å‹è¯­è¨€æ¨¡å‹åº”ç”¨ä¹‹åå‘å‡ºçš„å£°éŸ³ã€‚

ç„¶è€Œä½œä¸ºåŸºäºå¤§å‹è¯­è¨€æ¨¡å‹è¿›è¡Œå·¥ç¨‹åº”ç”¨å¼€å‘çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœåªæ˜¯é€šè¿‡å¯¹å¤§å‹è¯­è¨€æ¨¡å‹ç®€å•åœ°å‘èµ·è¯·æ±‚ï¼Œç”¨æˆ·çš„è¿™äº›è¯‰æ±‚æ˜¯å¾ˆéš¾è¢«æ»¡è¶³çš„ã€‚å› ä¸ºå¤§å‹è¯­è¨€æ¨¡å‹æœ¬èº«å¹¶ä¸èƒ½å…·å¤‡è®°å¿†ã€è§’è‰²è®¾å®šç®¡ç†ã€ä¸»åŠ¨æ„ŸçŸ¥è¿™äº›èƒ½åŠ›ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡åœ¨æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œå‘å®ƒæä¾›å……è¶³çš„ä¿¡æ¯ã€ç»™å‡ºæ›´è¯¦ç»†çš„æŒ‡ç¤ºæ¥å®Œæˆã€‚

è€Œå¦‚æœæˆ‘ä»¬è¦è®©ç”¨æˆ·ä¾ç„¶èƒ½å¤Ÿç”¨ä»–ä»¬æœŸå¾…ä¸­çš„ç®€å•çš„äº¤äº’æ–¹å¼å»å®Œæˆè¿™äº›å¤æ‚çš„ä»»åŠ¡ï¼Œå°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨æ¨¡å‹ä¹‹ä¸Šï¼Œæ„å»ºå‡ºèƒ½å¤Ÿæ»¡è¶³ç”¨æˆ·è¿™ç§æœŸå¾…çš„å·¥ç¨‹ç»“æ„ä½“ã€‚è€Œè¿™ä¸ªå·¥ç¨‹ç»“æ„ä½“å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„æ™ºèƒ½ä½“ï¼ˆAgentï¼‰

<img width="822" alt="image" src="https://github.com/Maplemx/Agently/assets/4413155/c2870366-575d-4fdb-a847-83feb1328d83">

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ™ºèƒ½ä½“ï¼ˆAgentï¼‰åŸºäºå¤§å‹è¯­è¨€æ¨¡å‹æä¾›çš„åŸºç¡€æ™ºåŠ›ï¼Œé€šè¿‡ä¸åŒçš„ç»„ä»¶ï¼ˆComponentï¼‰å¢å¼ºè‡ªèº«çš„èƒ½åŠ›ï¼Œä»è€Œæ»¡è¶³æ™®é€šç”¨æˆ·å¯¹å¤§å‹è¯­è¨€æ¨¡å‹çš„æ‰€æœ‰â€œå¹»è§‰â€ã€‚

## é¢å‘åº”ç”¨å¼€å‘è€…ï¼šAgentlyæä¾›æ–¹ä¾¿å¿«é€Ÿç”Ÿæˆèƒ½åŠ›å¼ºå¤§çš„Agentå®ä¾‹çš„èƒ½åŠ›ï¼Œè®©å¼€å‘è€…å¯ä»¥ä¾¿æ·åœ°å°†è¿™äº›å®ä¾‹ä¸è‡ªå·±çš„ä¸šåŠ¡ä»£ç ç›¸ç»“åˆ

### ç›´è§‚ã€æ¸…æ™°ã€ç»“æ„åŒ–

å¦‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ‰€å‘ˆç°çš„ï¼ŒAgentlyæ¡†æ¶æ„å»ºçš„Agentï¼Œèƒ½å¤Ÿä¸ºå·¥ç¨‹å¼€å‘äººå‘˜æä¾›ä¸°å¯Œçš„èƒ½åŠ›æ¥å£ï¼Œç”¨é“¾å¼è¡¨è¾¾çš„æ–¹å¼ï¼Œè®©å·¥ç¨‹å¼€å‘äººå‘˜æ¡ç†æ¸…æ™°åœ°è¡¨è¾¾è‡ªå·±çš„è¯‰æ±‚ï¼Œå¹¶è·å¾—ç»“æ„åŒ–çš„æ•°æ®è¿”å›ç»“æœã€‚

æ•´ä¸ªè¿‡ç¨‹ç›´è§‚æ˜“æ‡‚ï¼ŒAgentæ™ºèƒ½ä½“ä»¥å®ä¾‹çš„å½¢å¼å­˜åœ¨ï¼Œè·Ÿå®ƒçš„äº¤äº’å°±åƒå’Œä¸€ä¸ªå®ä½“å¯¹è¯ä¸€æ ·ç®€å•ã€‚

```python
import Agently

# åˆ›å»ºä¸€ä¸ªAgentå·¥å‚å®ä¾‹
# é€šè¿‡is_debug=Trueå¼€å¯ç ”å‘è°ƒè¯•æ¨¡å¼ï¼Œè·å¾—æ›´é€æ˜çš„è¿‡ç¨‹ä¿¡æ¯
agent_factory = Agently.AgentFactory(is_debug=True)

# è®¾ç½®å·¥å‚çš„é…ç½®é¡¹ï¼ˆè¿™äº›é…ç½®é¡¹å°†è¢«å·¥å‚ç”Ÿäº§çš„æ‰€æœ‰Agentç»§æ‰¿ï¼‰
agent_factory\
    .set_settings("model_settings.auth", { "api_key": GPT_API_KEY })\
    .set_settings("model_settings.url", GPT_BASE_URL)
    #.set_proxy("http://127.0.0.1:7890")

# åˆ›å»ºä¸€ä¸ªAgentå®ä¾‹
agent = agent_factory.create_agent()

# åˆ©ç”¨agentå®ä¾‹æä¾›çš„ä¸°å¯Œèƒ½åŠ›æ¥å£è¿›è¡Œè¯‰æ±‚è¡¨è¾¾
# é“¾å¼è¡¨è¾¾çš„å½¢å¼ï¼Œè®©è¯‰æ±‚è¡¨è¾¾ç»“æ„æ¸…æ™°æœ‰æ¡ç†
result = agent\
    .input("ç»™æˆ‘ä»‹ç»ä¸€ä¸‹åŒ—äº¬å‘¨è¾¹çš„æ™¯ç‚¹")\
    .output({
        "æ–‡åŒ–å¤è¿¹": [({ "åç§°": ("String",), "ä»‹ç»": ("String",) }, "å…·æœ‰å†å²ç‰¹è‰²çš„æ–‡åŒ–å¤è¿¹æ™¯ç‚¹")],
        "ç§‘æŠ€åšè§ˆ": [({ "åç§°": ("String",), "ä»‹ç»": ("String",) }, "èƒ½å¤Ÿå­¦ä¹ åˆ°åšç‰©ã€ç§‘æŠ€çŸ¥è¯†çš„æ™¯ç‚¹")],
        "äººæ–‡è‡ªç„¶": [({ "åç§°": ("String",), "ä»‹ç»": ("String",) }, "èƒ½å¤Ÿæ„Ÿå—åˆ°äººæ–‡è‡ªç„¶ä¹‹ç¾çš„æ™¯ç‚¹")],
    })\
    .start()
# å¹¶åœ¨æœ€ç»ˆè·å¾—ç»“æ„åŒ–çš„æ•°æ®è¿”å›ç»“æœ
print(result["äººæ–‡è‡ªç„¶"][0])
```
```ini
[è¾“å‡ºç»“æœ]
{'åç§°': 'é¢å’Œå›­', 'ä»‹ç»': 'é¢å’Œå›­æ˜¯ä¸­å›½å¤ä»£çš‡å®¶å›­æ—ï¼Œä½äºåŒ—äº¬è¥¿éƒŠã€‚å®ƒè¢«èª‰ä¸ºä¸­å›½å¤å…¸å›­æ—çš„ç‘°å®ï¼Œæ˜¯ä¸–ç•Œæ–‡åŒ–é—äº§ã€‚æ¸¸è§ˆé¢å’Œå›­ï¼Œå¯ä»¥æ¬£èµåˆ°ç²¾ç¾çš„å»ºç­‘å’Œä¼˜ç¾çš„æ™¯è§‚ï¼Œæ„Ÿå—åˆ°çš‡å®¶å›­æ—çš„å®é™å’Œé›…è‡´ã€‚'}
```
### é€šè¿‡ç»„ä»¶è·å¾—èƒ½åŠ›å¢å¼º

å½“ç„¶ï¼ŒAgentlyåœ¨åº”ç”¨å¼€å‘å±‚é¢çš„èƒ½åŠ›è¿˜ä¸æ­¢è¿™äº›ã€‚åº”ç”¨å¼€å‘è€…ä»¬å¯ä»¥é€šè¿‡å®‰è£…æ‰©å±•ç»„ä»¶çš„æ–¹å¼ï¼Œè·å¾—è¿›ä¸€æ­¥å¢å¼ºçš„èƒ½åŠ›ã€‚

ä¾‹å¦‚ï¼šé€šè¿‡ä½¿ç”¨Roleï¼ˆè§’è‰²ç®¡ç†ï¼‰ç»„ä»¶ï¼Œè·å¾—åŠ¨æ€ç®¡ç†è§’è‰²è®¾å®šã€å°†è§’è‰²è®¾å®šæŒä¹…åŒ–å­˜å‚¨ä¸‹æ¥çš„èƒ½åŠ›ã€‚

```python
import Agently
# ä½¿ç”¨æ¡†æ¶æä¾›çš„å¿«é€Ÿåˆ›å»ºagentçš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªagentå®ä¾‹
agent = Agently.create_agent()
# é€šè¿‡agentå®ä¾‹ä¸Šçš„è§’è‰²è®¾å®šæ–¹æ³•ï¼Œè®¾å®šä¸€ä¸ªè§’è‰²ï¼Œå¹¶ä¿å­˜ä¸‹æ¥
agent\
    .set_role("You NEVER use any words EXCEPT EMOJI to response any question.")\
    .save_role("Emojiå¤§ç©å®¶")
# è¿è¡Œè„šæœ¬è®©è§’è‰²è¢«æŒä¹…åŒ–å­˜å‚¨ä¸‹æ¥
```
```python
import Agently
# åœ¨å¦ä¸€ä¸ªè„šæœ¬ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„agentå®ä¾‹
agent = Agently.create_agent()
# ç»™agentå®ä¾‹é…ç½®è¯­è¨€æ¨¡å‹è¯·æ±‚ä¿¡æ¯
agent\
    .set_settings("model_settings.auth", { "api_key": GPT_API_KEY })\
    .set_settings("model_settings.url", GPT_BASE_URL)
# ä½¿ç”¨èƒ½åŠ›æ¥å£load_roleåŠ è½½ä¹‹å‰è®¾å®šå¥½çš„è§’è‰²
result = agent\
	.load_role("Emojiå¤§ç©å®¶")\
	.input("ç»™æˆ‘è®²ä¸€ä¸ªä¸­ä¸–çºªéª‘å£«çš„æ•…äº‹")\
	.start()
print(result)
```
```ini
[è¾“å‡ºç»“æœ]
ğŸ›¡ï¸ğŸ—¡ï¸ğŸ°ğŸ‘‘ğŸ˜‡ğŸ‘¼â¤ï¸ğŸ´ğŸ—¡ï¸ğŸ¹ğŸ’ªğŸ»ğŸ‰ğŸ”¥ğŸï¸ğŸ›¡ï¸ğŸ—¡ï¸ğŸ°ğŸ’•ğŸ‘‘ğŸ›¡ï¸ğŸ—¡ï¸ğŸ°ğŸ”š
```
åˆä¾‹å¦‚ï¼šé€šè¿‡ä½¿ç”¨Segmentï¼ˆè¾“å‡ºåˆ‡å—ï¼‰ç»„ä»¶ï¼Œè·å¾—å°†ä¸€æ¬¡è¯·æ±‚åˆ†å—å¤„ç†çš„èƒ½åŠ›ï¼Œåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­ï¼Œæ—¢è·å¾—æµå¼è¾“å‡ºçš„å“åº”é€Ÿåº¦ï¼Œåˆè·å¾—æ•°æ®ç»“æ„åŒ–è¾“å‡ºçš„å·¥ç¨‹å¯ç”¨æ€§ã€‚å†ç»“åˆReplyReformerï¼ˆè¾“å‡ºç»“æœé‡æ„ï¼‰ç»„ä»¶çš„èƒ½åŠ›ï¼ŒæŠŠæœ€ç»ˆçš„è¾“å‡ºç»“æœç¡®å®šä¸‹æ¥ã€‚

```python
# å‡†å¤‡ä¸€ä¸ªç”¨æˆ·æ ‡ç­¾å­˜æ”¾çš„å˜é‡
user_tags = set([])

# å®šä¹‰thinkingé˜¶æ®µéœ€è¦å¤„ç†çš„ä»»åŠ¡
def handle_thinking(data):
    new_user_tags = set(data["user_tags"])
    user_tags.update(new_user_tags)

# åˆ†æˆä¸¤æ®µå¼€å§‹ä»»åŠ¡
# ç¬¬ä¸€æ®µä»»åŠ¡thinkingåœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹å®Œæˆé—®é¢˜ç±»å‹çš„è§£æå’Œç”¨æˆ·æ ‡ç­¾çš„åˆ¤æ–­
# ç¬¬äºŒæ®µä»»åŠ¡replyåœ¨ç”¨æˆ·å¯è§çš„æƒ…å†µä¸‹è¿›è¡Œæµå¼è¾“å‡ºï¼Œè®©ç”¨æˆ·å¿«é€Ÿçœ‹åˆ°ç­”æ¡ˆ
# ç„¶åï¼Œé€šè¿‡reform_replyçš„èƒ½åŠ›æ¥å£ï¼ŒæŠŠresultç»“æœè°ƒæ•´æˆreplyéƒ¨åˆ†çš„å†…å®¹
result = agent\
    .input("èƒ½ä¸èƒ½ç”¨ä¸€ä¸ªç¨‹åºå‘˜èƒ½å¬æ‡‚çš„è¡¨è¾¾æ–¹å¼ï¼Œè¯´æ˜ä¸€ä¸‹æ°´è’¸è›‹çš„ç®€æ˜“åšæ³•")\
    .segment(
        "thinking",
        {
            "question_type": (
                "ä¸“ä¸šæŠ€æœ¯é—®é¢˜ | ç”Ÿæ´»å¸¸è¯†é—®é¢˜ | é—²èŠ | éœ€è¦æ‰§è¡Œç»“æœçš„ä»»åŠ¡ ",
                "{{input}}æŒ‡å‘çš„é—®é¢˜ç±»å‹"
            ),
            "user_tags": (
                "Array",
                "å¦‚æœæˆ‘è¦ä½¿ç”¨ä¸€äº›æ ‡ç­¾æ¥æè¿°ç”¨æˆ·çš„ç‰¹å¾ï¼Œä¾‹å¦‚èŒä¸šã€çˆ±å¥½ã€çŸ¥è¯†é¢†åŸŸç­‰ï¼Œæˆ‘åº”è¯¥æ€ä¹ˆæè¿°"
            ),
        },
        handle_thinking
    )\
    .segment(
        "reply",
        "å¯¹ç”¨æˆ·é—®é¢˜ç»™å‡ºçš„ç›´æ¥å›ç­”",
        lambda data: print(data, end=""),
        is_streaming = True
    )\
    .reform_reply(
        lambda data: data['reply']['reply']
    )\
    .start()
# æœ€åæˆ‘ä»¬æŠŠç”¨æˆ·æ ‡ç­¾æ‰“å°å‡ºæ¥ï¼Œçœ‹çœ‹ç”¨æˆ·ä¸å¯è§çš„åå°æ“ä½œæ˜¯å¦é¡ºåˆ©å®Œæˆ
print('[User Tags]', str(user_tags))
# å¹¶æŠŠé‡æ–°è°ƒæ•´ä¹‹åçš„resultç»“æœæ‰“å°å‡ºæ¥ï¼Œçœ‹çœ‹æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ
print('[Result]', result)
```
```ini
[æµå¼è¾“å‡ºéƒ¨åˆ†]
æ°´è’¸è›‹çš„ç®€æ˜“åšæ³•å¦‚ä¸‹ï¼š
1. å‡†å¤‡ææ–™ï¼šé¸¡è›‹2ä¸ªï¼Œæ¸…æ°´é€‚é‡ï¼Œç›é€‚é‡ï¼Œè‘±èŠ±é€‚é‡ã€‚
2. æ‰“é¸¡è›‹ï¼šå°†é¸¡è›‹æ‰“å…¥ç¢—ä¸­ï¼ŒåŠ å…¥é€‚é‡çš„ç›ï¼Œæ…æ‹Œå‡åŒ€ã€‚
3. åŠ æ°´ï¼šåœ¨é¸¡è›‹æ¶²ä¸­åŠ å…¥é€‚é‡çš„æ¸…æ°´ï¼Œæ…æ‹Œå‡åŒ€ã€‚
4. è’¸ç…®ï¼šå°†è‘±èŠ±æ’’åœ¨è’¸é”…åº•éƒ¨ï¼Œå°†è›‹æ¶²å€’å…¥è’¸é”…ä¸­ï¼Œç”¨ä¸­å°ç«è’¸ç…®çº¦8-10åˆ†é’Ÿã€‚
5. å®Œæˆï¼šå–å‡ºè’¸å¥½çš„æ°´è’¸è›‹ï¼Œæ’’ä¸Šä¸€äº›è‘±èŠ±ä½œä¸ºè£…é¥°å³å¯ã€‚å¯ä»¥å£æ„Ÿæ›´å¥½çš„è¯ï¼Œå¯ä»¥å†åŠ å…¥ä¸€äº›è°ƒæ–™ï¼Œå¦‚é…±æ²¹æˆ–ç•ªèŒ„é…±ç­‰ã€‚

å¸Œæœ›è¿™ä¸ªç®€æ˜“åšæ³•å¯¹ä½ æœ‰å¸®åŠ©ï¼Œenjoy your mealï¼
[User Tags] {'ç¨‹åºå‘˜'}
[Result] 
æ°´è’¸è›‹çš„ç®€æ˜“åšæ³•å¦‚ä¸‹ï¼š
1. å‡†å¤‡ææ–™ï¼šé¸¡è›‹2ä¸ªï¼Œæ¸…æ°´é€‚é‡ï¼Œç›é€‚é‡ï¼Œè‘±èŠ±é€‚é‡ã€‚
2. æ‰“é¸¡è›‹ï¼šå°†é¸¡è›‹æ‰“å…¥ç¢—ä¸­ï¼ŒåŠ å…¥é€‚é‡çš„ç›ï¼Œæ…æ‹Œå‡åŒ€ã€‚
3. åŠ æ°´ï¼šåœ¨é¸¡è›‹æ¶²ä¸­åŠ å…¥é€‚é‡çš„æ¸…æ°´ï¼Œæ…æ‹Œå‡åŒ€ã€‚
4. è’¸ç…®ï¼šå°†è‘±èŠ±æ’’åœ¨è’¸é”…åº•éƒ¨ï¼Œå°†è›‹æ¶²å€’å…¥è’¸é”…ä¸­ï¼Œç”¨ä¸­å°ç«è’¸ç…®çº¦8-10åˆ†é’Ÿã€‚
5. å®Œæˆï¼šå–å‡ºè’¸å¥½çš„æ°´è’¸è›‹ï¼Œæ’’ä¸Šä¸€äº›è‘±èŠ±ä½œä¸ºè£…é¥°å³å¯ã€‚å¯ä»¥å£æ„Ÿæ›´å¥½çš„è¯ï¼Œå¯ä»¥å†åŠ å…¥ä¸€äº›è°ƒæ–™ï¼Œå¦‚é…±æ²¹æˆ–ç•ªèŒ„é…±ç­‰ã€‚

å¸Œæœ›è¿™ä¸ªç®€æ˜“åšæ³•å¯¹ä½ æœ‰å¸®åŠ©ï¼Œenjoy your mealï¼
```
> â„¹ï¸ Tips 1ï¼šæ›´å¤šæ¨¡å—èƒ½åŠ›å¯ä»¥æŸ¥é˜…æ¡†æ¶/plugins æ–‡ä»¶å¤¹çš„ä¿¡æ¯äº†è§£è¯¦æƒ…ã€‚
> 
> â„¹ï¸ Tips 2ï¼šé€šè¿‡æ‰§è¡Œ`agent.alias_manager.print_alias_info()`æ–¹æ³•ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„agentå®ä¾‹æ‹¥æœ‰çš„èƒ½åŠ›æ¥å£ä¿¡æ¯

### å’Œå…¶ä»–åº”ç”¨å·¥ç¨‹çš„ç»“åˆ

Agentlyæä¾›çš„agentå®ä¾‹èƒ½å¤Ÿå’Œå…¶ä»–åº”ç”¨å·¥ç¨‹åº“ç»“åˆèµ·æ¥ï¼Œåº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

åœ¨è¿™é‡Œæˆ‘ä»¬ç”¨Agently x tornado ä¸ºæŸä¸ªæ¸¸æˆåœºæ™¯æ­å»ºçš„websocketæœåŠ¡ä¸¾ä¾‹ï¼š

```python
import asyncio
import tornado.ioloop
import tornado.web
import tornado.websocket
import json
import Agently

agent_factory = Agently.AgentFactory(is_debug=True)
agent_factory\
    .set_settings("model_settings.auth", { "api_key": ENV.GPT_API_KEY })\
    .set_settings("model_settings.url", ENV.GPT_BASE_URL)

agent = agent_factory.create_agent()

# WebSocket å¤„ç†å™¨
class WebSocketHandler(tornado.websocket.WebSocketHandler):
    async def on_message(self, message):
        try:
            data = json.loads(message)
            print("Data Received:", data)
            result = await agent\
                .set_role(data["role"])\
                .input({
                    "scene_desc": data["scene"],
                })\
                .segment(
                    "act",
                    "{{ROLE}}çœ‹åˆ°{{input.scene_desc}}æè¿°çš„åœºæ™¯æ—¶çš„è¡ŒåŠ¨å’Œè¯è¯­",
                    lambda data: self.write_message(json.dumps({
                        "status": 200,
                        "data": { "event": "act", "delta": data },
                    })),
                    is_streaming=True
                )\
                .segment(
                    "action_options",
                    {
                        "action_options": [("String", "åŸºäº{{ROLE}}çš„è®¾å®šå’Œ{{input.scene_desc}}çš„åœºæ™¯æè¿°ï¼Œç”Ÿæˆä¸è¶…è¿‡3ä¸ªè§’è‰²çš„åç»­è¡ŒåŠ¨é€‰é¡¹æè¿°ï¼Œæ ¼å¼è¦æ±‚ä¸º'<è¡ŒåŠ¨åç§°>ï¼š<è§’è‰²åšå‡ºè¿™ä¸ªè¡ŒåŠ¨çš„å¿ƒç†æ´»åŠ¨å’Œç»“æœé¢„æœŸ>'ï¼Œä¾‹å¦‚'è·³è¿‡æ·±å‘ï¼šçœ‹åˆ°è¿™ä¸ªæ·±å‘ï¼Œæˆ‘ä¸ç¡®å®šè‡ªå·±æ˜¯å¦çœŸçš„èƒ½å¤Ÿè·³è¿‡å»ï¼Œä½†æ˜¯ç›ä¸½è²åœ¨å¯¹é¢ç­‰ç€æˆ‘å»æ•‘å¥¹ï¼Œæˆ‘å¿…é¡»åŠªåŠ›ä¸€è¯•ï¼Œå“ªæ€•æˆ‘å¯èƒ½æ‘”ä¸ªåŠæ­»'")]
                    },
                    lambda data: self.write_message(json.dumps({
                        "status": 200,
                        "data": { "event": "action_options", "content": data }
                    })),
                    is_streaming=False
                )\
                .async_start()
            self.write_message(json.dumps({
                "status": 200,
                "data": { "event": "full_result", "content": result }
            }))
            self.close()
        except Exception as e:
            self.write_message(json.dumps({
                "status": 400,
                "msg": str(e),
            }))
            self.close()

# Web åº”ç”¨
class Application(tornado.web.Application):
    def __init__(self):
        handlers = [("/game", WebSocketHandler)]
        super(Application, self).__init__(handlers)

if __name__ == "__main__":
    app = Application()
    app.listen(15365)
    print("WebSocket æœåŠ¡å·²å¯åŠ¨")
    tornado.ioloop.IOLoop.current().start()
```
```python
[Serverç«¯]
Data Received: {'role': 'äºšç‘Ÿï¼Œä¸€ä¸ªå…·æœ‰å¤å…¸éª‘å£«ç²¾ç¥çš„è¥¿éƒ¨å†’é™©è€…ï¼Œçƒ­æƒ…ã€è±ªçˆ½ã€ä¸æ‹˜å°èŠ‚', 'scene': 'æ£®æ—çš„æ·±å¤„ä¼ æ¥æœªçŸ¥çš„å“åŠ¨ï¼Œè®©äººæ¯›éª¨æ‚šç„¶ã€‚å‰å°”æ–¯çš„è¯è¿˜å›è¡åœ¨è€³è¾¹ï¼šâ€œå¦‚æœè¦è¿½å¯»é‚£æœªçŸ¥çš„å®è—ï¼Œèƒ†å°çš„äººï¼Œè¿˜æ˜¯å°½å¿«æ‰“é“å›åºœå§ï¼â€ä½ å›å¤´çœ‹çœ‹ä¼™ä¼´ï¼Œå¤§å®¶å·²ç»ç–²æƒ«ä¸å ªï¼Œå‰è¿›è¿˜æ˜¯æ’¤é€€ï¼Ÿä»–ä»¬ç­‰å¾…ä½ çš„å›ç­”ã€‚'}
[Clientç«¯]
{'status': 200, 'data': {'event': 'act', 'delta': '\n'}}
{'status': 200, 'data': {'event': 'act', 'delta': 'äºš'}}
{'status': 200, 'data': {'event': 'act', 'delta': 'ç‘Ÿ'}}
...
{'status': 200, 'data': {'event': 'act', 'delta': 'æ˜¯'}}
{'status': 200, 'data': {'event': 'act', 'delta': 'ä»€'}}
{'status': 200, 'data': {'event': 'act', 'delta': 'ä¹ˆ'}}
{'status': 200, 'data': {'event': 'act', 'delta': 'ï¼'}}
{'status': 200, 'data': {'event': 'act', 'delta': 'â€'}}
{'status': 200, 'data': {'event': 'act', 'delta': '\n'}}
{'status': 200, 'data': {'event': 'action_options', 'content': {'action_options': ['ç»§ç»­å‰è¿›ï¼šäºšç‘Ÿå¯¹ä¼™ä¼´ä»¬è¯´é“ï¼šâ€œä¸ç®¡å‰æ–¹ä¼šæœ‰æ€æ ·çš„å±é™©ï¼Œæˆ‘ä»¬éƒ½è¦å‹‡å¾€ç›´å‰ï¼åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å‘ç°çœŸæ­£çš„å®è—ä¹‹æ‰€åœ¨ã€‚â€', 'æ’¤é€€å›åºœï¼šäºšç‘Ÿè€ƒè™‘äº†ä¸€ä¸‹ä¼™ä¼´ä»¬çš„ç–²æƒ«ï¼Œæœ€ç»ˆå†³å®šï¼šâ€œè™½ç„¶å†…å¿ƒæ¸´æœ›å†’é™©ï¼Œä½†ç°åœ¨çš„æƒ…å†µï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ’¤é€€å›åºœï¼Œç­‰å¤§ä¼™å„¿ç²¾ç¥æ¢å¤å†æ¥æ¢å¯»å®è—ã€‚â€', 'è°ƒæŸ¥å“åŠ¨ï¼šäºšç‘Ÿå¯¹ä¼™ä¼´ä»¬è¯´é“ï¼šâ€œæˆ‘ä»¬å…ˆè°ƒæŸ¥ä¸€ä¸‹é‚£ä¸ªæœªçŸ¥çš„å“åŠ¨ï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆå“åˆ°äº†å¤§å®¶ã€‚ä¹Ÿè®¸è¿™ä¸ªçº¿ç´¢èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°å®è—ã€‚â€']}}}
{'status': 200, 'data': {'event': 'full_result', 'content': {'act': '\näºšç‘Ÿçœ‹åˆ°æ£®æ—æ·±å¤„ä¼ æ¥æœªçŸ¥çš„å“åŠ¨ï¼Œç«‹åˆ»å±•ç°å‡ºå…¸å‹çš„å†’é™©å®¶ç²¾ç¥ï¼Œä»–æ¯«ä¸çŠ¹è±«åœ°è¿ˆå‘å‰æ–¹ï¼Œçœ¼ä¸­é—ªçƒç€æ¢é™©çš„å†³å¿ƒã€‚ä»–å¯¹å‰å°”æ–¯è¯´é“ï¼šâ€œèƒ†å°æ€•äº‹çš„äººåªä¼šé”™è¿‡è¿™æ ·çš„æœºé‡ï¼æˆ‘ä»¬å¿…é¡»ç»§ç»­å‰è¿›ï¼Œçœ‹çœ‹é‚£æœªçŸ¥çš„å®è—ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼â€\n', 'action_options': '\n{\n\t"action_options": \n\t[\n\t\t"ç»§ç»­å‰è¿›ï¼šäºšç‘Ÿå¯¹ä¼™ä¼´ä»¬è¯´é“ï¼šâ€œä¸ç®¡å‰æ–¹ä¼šæœ‰æ€æ ·çš„å±é™©ï¼Œæˆ‘ä»¬éƒ½è¦å‹‡å¾€ç›´å‰ï¼åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å‘ç°çœŸæ­£çš„å®è—ä¹‹æ‰€åœ¨ã€‚â€",\n\t\t"æ’¤é€€å›åºœï¼šäºšç‘Ÿè€ƒè™‘äº†ä¸€ä¸‹ä¼™ä¼´ä»¬çš„ç–²æƒ«ï¼Œæœ€ç»ˆå†³å®šï¼šâ€œè™½ç„¶å†…å¿ƒæ¸´æœ›å†’é™©ï¼Œä½†ç°åœ¨çš„æƒ…å†µï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ’¤é€€å›åºœï¼Œç­‰å¤§ä¼™å„¿ç²¾ç¥æ¢å¤å†æ¥æ¢å¯»å®è—ã€‚â€",\n\t\t"è°ƒæŸ¥å“åŠ¨ï¼šäºšç‘Ÿå¯¹ä¼™ä¼´ä»¬è¯´é“ï¼šâ€œæˆ‘ä»¬å…ˆè°ƒæŸ¥ä¸€ä¸‹é‚£ä¸ªæœªçŸ¥çš„å“åŠ¨ï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆå“åˆ°äº†å¤§å®¶ã€‚ä¹Ÿè®¸è¿™ä¸ªçº¿ç´¢èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°å®è—ã€‚â€"\n\t]\n}'}}}
```
ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨agentå®ä¾‹çš„async_start()æ–¹æ³•ï¼Œå°†agentçš„å¤„ç†é€»è¾‘å’ŒWebsocketçš„å“åº”å¤„ç†é€»è¾‘è¿›è¡Œäº†ç»“åˆã€‚åœ¨æ¸¸æˆåœºæ™¯ä¸­ï¼ŒåŒæ—¶æ»¡è¶³äº†å¿«é€Ÿå‘ç©å®¶è¿›è¡Œåœºæ™¯è¡¨ç°è¾“å‡ºï¼Œå’Œä¸ºæ¸¸æˆç³»ç»Ÿç”Ÿæˆåç»­è¡ŒåŠ¨é€‰é¡¹çš„ä»»åŠ¡ã€‚

## é¢å‘Agentå¼€å‘è€…ï¼šç”¨ç»„ä»¶åŒ–çš„æ–¹å¼å¢é‡å¼€å‘æ‰©å±•Componentï¼Œå¢å¼ºAgentçš„èƒ½åŠ›

ï¼ˆæœ¬éƒ¨åˆ†å†…å®¹ä»åœ¨æ’°å†™ä¸­ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…ˆæŸ¥çœ‹[src/python/v3/plugins/agent_component](https://github.com/Maplemx/Agently/tree/main/src/python/v3/plugins/agent_component)çš„æºä»£ç äº†è§£è®¾è®¡æ€æƒ³ï¼‰
